<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>球形滚动</title>
        <style>
            .container {
                width: 800px;
                height: 800px;
                margin: 50px auto;
                position: relative;
                border: 1px solid green;
            }
            .tag {
                display: block;
                position: absolute;
                color: #000;
                font-family: Microsoft YaHei;
                font-size: 15px;
                /*font-weight: bold;*/
            }
            .tag:hover {
                border: 1px solid lime;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <label class="tag">呵呵</label>
            <label class="tag">呵呵</label>
            <label class="tag">呵呵</label>
            <label class="tag">呵呵</label>
            <label class="tag">呵呵</label>
            <label class="tag">呵呵</label>
            <label class="tag">呵呵</label>
            <label class="tag">呵呵</label>
            <label class="tag">呵呵</label>
            <label class="tag">呵呵</label>
            <label class="tag">呵呵</label>
            <label class="tag">呵呵</label>
            <label class="tag">呵呵</label>
            <label class="tag">呵呵</label>
            <label class="tag">呵呵</label>
            <label class="tag">呵呵</label>
            <label class="tag">呵呵</label>
            <label class="tag">呵呵</label>
            <label class="tag">呵呵</label>
            <label class="tag">呵呵</label>
            <label class="tag">呵呵</label>
            <label class="tag">呵呵</label>
            <label class="tag">呵呵</label>
            <label class="tag">呵呵</label>
            <label class="tag">呵呵</label>
            <label class="tag">呵呵</label>
            <label class="tag">呵呵</label>
            <label class="tag">呵呵</label>
            <label class="tag">呵呵</label>
            <label class="tag">呵呵</label>
            <label class="tag">呵呵</label>
            <label class="tag">呵呵</label>
            <label class="tag">呵呵</label>
            <label class="tag">呵呵</label>
            <label class="tag">呵呵</label>
            <label class="tag">呵呵</label>
            <label class="tag">呵呵</label>
            <label class="tag">呵呵</label>
            <label class="tag">呵呵</label>
            <label class="tag">呵呵</label>
        </div>
<script>
var log = function() {
    console.log.apply(console, arguments)
}
var cloud = function() {
    this.container = document.querySelector(".container")
    this.tags = document.querySelectorAll(".tag")
    this.tagObjs = []
    this.radius = 300
    this.fallLength = 500
    this.angleX = Math.PI / 500
    this.angleY = Math.PI / 500
    this.innerX = this.container.offsetWidth / 2
    this.innerY = this.container.offsetHeight / 2
    this.outerX = this.container.offsetLeft + document.body.scrollLeft
    this.outerY = this.container.offsetTop + document.body.scrollTop
}
cloud.prototype.init = function() {
    for(var i = 0; i < this.tags.length; i++) {
        // 为了初始化得更加均匀，像一个球，不随机生成参数，而是与元素序号相关
        var t = ((i + 1) * 2 - 1) / this.tags.length - 1
        var a = Math.acos(t)
        var b = a * Math.sqrt(this.tags.length * Math.PI)
        // 计算出每个元素的相对生成位置
        var x = this.radius * Math.sin(a) * Math.cos(b)
        var y = this.radius * Math.sin(a) * Math.sin(b)
        var z = this.radius * Math.cos(a)
        this.tags[i].style.color = `rgb(${parseInt(Math.random()*255)}, ${parseInt(Math.random()*255)}, ${parseInt(Math.random()*255)})`
        var t = new tagObj(this.tags[i], x, y, z)
        this.tagObjs.push(t)
        t.move(this)
    }
    this.container.addEventListener("mousemove", function(e) {
        var x = e.clientX - this.innerX - this.outerX
        var y = e.clientY - this.innerY - this.outerY
        this.angleY = 0.0001 * x
        this.angleX = 0.0001 * y
    }.bind(this))
}
cloud.prototype.animate = function() {
    var obj = this
    setInterval(function(){
        obj.rotateX()
        obj.rotateY()
        obj.tagObjs.forEach(function(e){
            e.move(obj)
        })
    }, 30)
}
cloud.prototype.rotateX = function() {
    // 元素在x轴上的移动，也就是更改y坐标
    var cos = Math.cos(this.angleX)
    var sin = Math.sin(this.angleX)
    this.tagObjs.forEach(function(e) {
        var y1 = e.y * cos - e.z * sin
        var z1 = e.z * cos + e.y * sin
        e.y = y1
        e.z = z1
    })
}
cloud.prototype.rotateY = function() {
    var cos = Math.cos(this.angleY)
    var sin = Math.sin(this.angleY)
    this.tagObjs.forEach(function(e) {
        var x1 = e.x * cos - e.z * sin
        var z1 = e.z * cos + e.x * sin
        e.x = x1
        e.z = z1
    })
}
var tagObj = function(ele, x, y, z) {
    this.ele = ele
    this.x = x
    this.y = y
    this.z = z
}
tagObj.prototype.move = function(e) {
    var scale = e.fallLength / (e.fallLength - this.z)
    var alpha = (this.z + e.radius) / (2 * e.radius)
    this.ele.style.fontSize = parseInt(15 * scale) + "px"
    this.ele.style.opacity = alpha + 0.5
    this.ele.style.filter = `alpha(opacity = ${(alpha + 0.5) * 100})`
    this.ele.style.zIndex = parseInt(scale * 100)
    this.ele.style.left = this.x + e.innerX - this.ele.offsetWidth/2 + "px"
    this.ele.style.top = this.y + e.innerY - this.ele.offsetHeight/2 + "px"
}

var cld = new cloud()
cld.init()
cld.animate()

</script>
    </body>
</html>
