<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>brick game</title>
    <style>
        #id-canvas {
            border: 1px solid black;
            background-color: #eee;
        }
    </style>
</head>
<body>
    <canvas id="id-canvas" width="600" height="400"></canvas>

<script>

function imageFromPath ( path ) {
    const img = new Image()
    img.src = path
    return img
}

function Paddle () {
    const img = imageFromPath( 'paddle.png' )
    const p = {
        image: img,
        x: 0,
        y: 280,
        speed: 10,
    }
    p.moveLeft = function () {
        p.x -= p.speed
    }
    p.moveRight = function () {
        p.x += p.speed
    }

    return p
}

function Ball () {
    const img = imageFromPath( 'ball.png' )
    const p = {
        image: img,
        x: 20,
        y: 220,
        speed: 15,
    }
    p.move = function ( x, y ) {

    }

    return p
}


function Game () {
    const canvas = document.getElementById( 'id-canvas' )
    const ctx = canvas.getContext( '2d' )

    const g = {
        canvas: canvas,
        context: ctx,
        actions: {},
        keydowns: {}        //  这就是注册的写法
    }

    // events
    window.addEventListener( 'keydown', function ( event ) {
        const key = event.key
        g.keydowns[ key ] = true
    } )
    window.addEventListener( 'keyup', function( event ) {
        const key = event.key
        g.keydowns[ key ] = false
    } )

    g.registerAction = function ( key, callback ) {
        g.actions[ key ] = callback
    }
    g.drawImage = function ( paddle ) {
        g.context.drawImage( paddle.image, paddle.x, paddle.y, paddle.image.width, paddle.image.height )
    }
    setInterval( function () {
        // register events
        const actions = Object.keys( g.actions )
        for ( let i = 0; i < actions.length; i++ ) {
            const key = actions[ i ]
            if ( g.keydowns[ key ] ) {
                g.actions[ key ]()
            }
        }

        // clear
        g.context.clearRect( 0, 0, g.canvas.width, g.canvas.height )
        // draw
        g.draw()
    }, 1000 / 30 )

    return g
}

const __main = function () {

    const paddle = Paddle()
    const game = Game()
    const ball = Ball()

    game.registerAction( 'a', paddle.moveLeft )
    game.registerAction( 'd', paddle.moveRight )

    game.draw = function () {
        game.drawImage( paddle )
        game.drawImage( ball )
    }

}

__main()

</script>
</body>
</html>